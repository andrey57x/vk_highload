# Яндекс Лавка

## 1. Тема

Яндекс Лавка - система доставки продуктов питания. Ключевым функционалом сервиса является полный цикл заказа продуктов: от поиска товаров до управления статусами заказа.

## 2. Целевая аудитория

- География: 15 крупных городов России [1]
- Количество дарксторов: 663 распределенных точки сборки заказов [4]
- Активность:
  - Среднесуточное количество заказов: 400 тысяч [2]
  - Дневная активная аудитория: ~2 млн пользователей (в среднем 20% посетителей делают заказ)
  - Месячная активная аудитория: ~5 млн пользователей (средняя рыночная частота покупок в сегменте eGrocery — 2.4 заказа на пользователя в месяц)

## 3. Ключевой функционал

1.  Определение зоны доставки и даркстора
2.  Просмотр динамического каталога
3.  Поиск по товарам
4.  Оформление заказа и резервирование остатков
5.  Система управления статусами заказа
6.  Назначение курьеров на заказ
7.  Отслеживание курьера на карте в реальном времени

## 4. Ключевые продуктовые решения

1.  Бронирование происходит в момент добавления в корзину, чтобы минимизировать отказы из-за отсутствия товаров в дарксторе
2.  Курьерское приложение отправляет GPS-координаты каждые 5 секунд
3.  Система решает, может ли один курьер взять два и более заказов, если они находятся в соседних домах

## 5. Расчет среднего пути пользователя

Сценарий «Один заход клиента»:

1.  Запуск приложения: 1 запрос (авторизация).
2.  Просмотр продуктов: 8 запросов (пользователь просматривает в среднем 8 категорий).
3.  Поиск продуктов: 3 поисковых запроса.

Итого на 1 сессию: ~12 запросов

Сценарий «Один успешный заказ»:

1.  Корзина: 10 запросов (добавление 10 товаров).
2.  Оформление заказа: 1 запрос (нажатие кнопки «Оплатить»).
3.  Ожидание: 5 запросов (пользователь заходит проверить статус заказа 5 раз).
4.  Отслеживание курьера: 240 запросов (заказ едет 20 минут, приложение запрашивает GPS курьера раз в 5 секунд).

Итого на 1 заказ: ~256 запросов.

## 6. Продуктовые метрики

| Метрика                                         | Значение | Обоснование / Источник                                              |
| ----------------------------------------------- | -------- | ------------------------------------------------------------------- |
| MAU (Месячная аудитория)                        | 5 млн    | На основе ежемесячных заказов                                       |
| DAU (Дневная аудитория)                         | 2 млн    | Расчет через конверсию заказов в сессии                             |
| Размер хранилища пользователя                   | 5 Кб     | Метаданные, ID, 1-2 активных адреса, кэш корзины                    |
| Один заказ пользователя                         | 2 Кб     | ID пользователя, заказов и товаров в заказе, также позиции в заказе |
| Количество заказов на одного пользователя в год | 30       | 2,4 \* 12 ~ 30 заказов в год                                        |
| Количество заходов                              | 5 млн    | Пользователь заходит 2-3 раза в день посмотреть товары              |
| Заказов в сутки                                 | 400 тыс  | Прямые расчет через долю в рынке и объяму рынка [2, 3]              |

## 7. Размер хранения на 1 год

| Тип данных       | Кол-во записей (шт) | Размер записи | Всего (Тб) | Обоснование                                             |
| :--------------- | :------------------ | :------------ | :--------- | :------------------------------------------------------ |
| Пользователи     | 5 млн               | 5 Кб          | 0.025      | Профиль, настройки, адреса                              |
| Товары           | 3.3 млн             | 0.5 Кб        | 0.001      | 5000 SKU [5] \* 663 даркстора                           |
| Заказы (История) | 146 млн             | 2 Кб          | 0.27       | 400к заказов/день \* 365 дней                           |
| GPS-логи (Logs)  | 3 млрд              | 0.1 Кб        | 0.3        | 400к зак. _ 240 точек/зак _ 30 дней (храним логи месяц) |
| ИТОГО            |                     |               | ~0.6 Тб    | Суммарный объем БД за год                               |

## 8. Расчет RPS

Для расчета пикового RPS используем коэффициент k=5. Данное значение обусловлено ярко выраженной неравномерностью спроса в сервисах доставки продуктов питания (пики в часы завтрака, обеда и ужина). Формула: Средний RPS = (Всего запросов в сутки) / 86400. Пиковый = Средний \* 5.

| Группа запросов   | Тип   | Кол-во в сутки | Средний RPS | Пиковый RPS |
| :---------------- | :---- | :------------- | :---------- | :---------- |
| Авторизация       | Read  | 5 000 000      | 58          | 290         |
| Каталог           | Read  | 16 000 000     | 185         | 925         |
| Поиск товаров     | Read  | 6 000 000      | 70          | 350         |
| Работа с корзиной | Write | 4 000 000      | 46          | 230         |
| Создание заказа   | Write | 400 000        | 5           | 25          |
| Статус заказа     | Read  | 2 000 000      | 23          | 115         |
| GPS (Write)       | Write | 96 000 000     | 1 111       | 5 555       |
| GPS (Read)        | Read  | 96 000 000     | 1 111       | 5 555       |
| Итого             |       | ~225 млн       | ~2 609      | ~13 045     |

## 9. Сетевой трафик

| Тип трафика         | Ср. размер запроса | Пик. нагрузка (Гбит/с) | Суточный объем (Тбайт) | Обоснование                            |
| :------------------ | :----------------- | :--------------------- | :--------------------- | :------------------------------------- |
| API (Каталог/Поиск) | 10 Кб              | 0.102                  | 0.220                  | JSON со списками товаров и метаданными |
| API (Заказы/Статус) | 2 Кб               | 0.005                  | 0.012                  | Легкие транзакционные данные           |
| GPS Телеметрия      | 0.5 Кб             | 0.044                  | 0.096                  | Координаты курьеров (Write + Read)     |
| Итого API           |                    | 0.151 Гбит/с           | 0.328 Тбайт            | Суммарный трафик бэкенда               |

## Источники

1. https://lavka.yandex.ru/about/franchise
2. https://datainsight.ru/sites/default/files/DI_eGrocery_Demo_aug23.pdf
3. https://datainsight.ru/sites/default/files/DI_eGrocery_january_2026_public.pdf
4. https://yastatic.net/s3/ir-docs/docs/2025/q3/25b90c11d0060d861ec0957dbbb96eeb/3Q25_IR_Presentation_RUS_6eeb.pdf
5. https://www.retail.ru/photoreports/robotizirovannyy-darkstor-yandeks-lavki-dvizhushchiesya-stellazhi-i-kontseptsiya-upravlyaemogo-khaos/?ysclid=mm1tu3ghk1753806057
